<html>
    <head>
        <title>Hello Habr</title>
        <link rel="manifest" href="manifest.json">
        <script src="hh.js"></script>
        <link rel="stylesheet" href="hh.css?v=2" />
        <script type="text/javascript">
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                .then(function(registration) {
                    console.log('Registration successful, scope is:', registration.scope);
                })
                .catch(function(error) {
                    console.log('Service worker registration failed, error:', error);
                });
            }

            let deferredPrompt; // Переменная, чтобы хранить запрос на установку
            window.addEventListener('beforeinstallprompt', (e) => {
                  e.preventDefault(); // сразу запрос не выдаем
                  deferredPrompt = e; // запоминаем в переменную
            });
            // javascript
            window.addEventListener('load', function(){
                const installApp = document.getElementById('installApp');
                installApp.addEventListener('click', async () => 
                {
                      if (deferredPrompt !== null) 
                      {
                            deferredPrompt.prompt();
                            const { outcome } = await deferredPrompt.userChoice;
                            if (outcome === 'accepted') 
                            {
                                      deferredPrompt = null;
                            }
                      }
                });
            });
            
        </script>
        <style>
            #installApp {
                    display: none;
                    background-color: yellow;
                    height: fit-content;
                    width: fit-content;
                    color:red;
            }
            @media (display-mode: browser) {
                    #installApp {
                    display: block;
                }
            }
        </style>
    </head>
    <body>
        <button id="installApp">Установить как приложение</button>
        <div class="center">
            <p id="text"></p>
        </div>
        <div id="logo"></div>
    </body>
</html>
